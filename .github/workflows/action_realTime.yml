name: Run Data Real-Time cada 15 minutos
on:
  schedule:
    - cron: "0 * * * *"  # Cada 15 minutos
  workflow_dispatch:      # Para ejecutarlo manualmente

jobs:
  run-notebooks:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        notebook:
          - { file: downLoadDataRealtimeAlpha.ipynb, msg: "Update data notebook" }
          - { file: PM40_PromedioMovil40.ipynb, msg: "Update PM40" }
          - { file: BreakOut_Indicator.ipynb, msg: "Update Ruptura canal" }
          - { file: CNCF_CaidaNormalCaidaFuerte.ipynb, msg: "Update Caida Normal Caida Fuerte" }
          - { file: PrimerGapAlza.ipynb, msg: "Update Gap a la Alza" }
          - { file: pisoFuerte.ipynb, msg: "Update Piso Fuerte" }

    steps:
      - uses: actions/checkout@v3
        with: { fetch-depth: 0, token: ${{ secrets.GIT_ACTION }} }
      - name: Configurar Git
        run: |
          git config user.email "…"
          git config user.name "…"
      - name: Conda & ejecutar {{ matrix.notebook.file }}
        uses: conda-incubator/setup-miniconda@v2
        with:
          python-version: '3.10'
          environment-name: myenv
          channels: conda-forge
      - run: |
          conda install -y papermill ipykernel pandas numpy scikit-learn yfinance ta-lib backtesting
          papermill {{ matrix.notebook.file }} /dev/null -k python3
      - name: Commit & Push
        env: { TOKEN: ${{ secrets.GIT_ACTION }} }
        run: |
          git add .
          git commit -m "${{ matrix.notebook.msg }}" || echo "No changes"
          git pull --rebase origin main
          git push origin HEAD:main
